#ifndef MT_SPOWER_CPU_H
#define MT_SPOWER_CPU_H



#define VSIZE 10
#define TSIZE 20
#define MAX_TABLE_SIZE 3

/**  PLEASE MAKE SURE the following things for table interpolation:
 * 1. table order: FF, TT, SS; such that, the order is necessarily obey as following:
 *       the power at (1150, 30) shoule be descent absoultely.
 **/

#define CPU_TABLE_0                                                   \
        /* "(WAT 8.62%) Leakage Power"	 */                             \
        /**/   	        800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,44,56,72,91,115,145,180,224,277,342, \
				30,51,66,84,106,133,167,207,257,318,390, \
				35,60,76,97,122,154,192,238,295,363,445, \
				40,69,88,112,141,177,220,273,337,414,506, \
				45,81,102,129,163,203,253,313,385,471,574, \
				50,93,119,149,187,233,289,357,438,535,651, \
				55,108,137,172,215,267,331,407,498,607,737, \
				60,125,158,198,247,306,377,463,565,687,832, \
				65,144,182,227,282,349,430,526,641,779,942, \
				70,167,209,261,323,399,490,599,728,881,1061, \
				75,192,240,298,369,455,557,679,824,994,1194, \
				80,220,275,341,421,518,633,769,930,1119,1343, \
				85,252,314,389,480,589,718,869,1049,1261,1509, \
				90,289,359,444,546,668,812,982,1183,1418,1694, \
				95,330,410,506,621,756,918,1108,1332,1593,1897, \
				100,377,467,575,704,856,1037,1248,1496,1785,2120, \
				105,431,532,653,797,967,1168,1403,1677,1996,2364, \
				110,491,604,739,900,1089,1312,1573,1876,2228,2632, \
				115,557,685,836,1014,1224,1471,1760,2096,2482,2925, \
				120,632,775,944,1142,1375,1649,1967,2336,2758,3243

#define CPU_TABLE_1                                                   \
        /* "(WAT 1.72%) Leakage Power"  */                              \
        /**/   	        800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,15,19,24,30,37,46,57,71,88,108, \
				30,17,22,27,34,43,53,66,81,100,123, \
				35,20,25,32,40,49,61,76,93,115,141, \
				40,23,29,37,46,57,70,87,107,131,160, \
				45,27,34,43,53,66,81,100,122,149,182, \
				50,32,40,49,61,76,93,114,140,171,208, \
				55,37,46,57,71,87,107,131,160,194,236, \
				60,43,53,66,81,100,123,150,183,222,269, \
				65,50,62,76,94,115,141,172,209,253,305, \
				70,58,71,88,108,132,161,196,238,288,347, \
				75,67,82,101,124,152,184,224,270,326,392, \
				80,77,95,117,143,174,211,255,308,370,444, \
				85,89,110,134,164,199,241,291,351,421,503, \
				90,104,127,155,189,229,276,333,399,478,570, \
				95,120,147,179,217,262,316,380,455,542,645, \
				100,139,169,206,249,301,362,433,517,615,731, \
				105,161,196,238,287,345,414,494,589,699,829, \
				110,186,226,273,329,395,472,563,670,794,940, \
				115,215,260,314,377,452,540,642,762,901,1063, \
				120,249,300,361,433,517,616,731,865,1021,1200

#define CPU_TABLE_2							\
        /*"(WAT -11.35%) Leakage Power" */                               \
        /**/  	        800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,10,13,16,20,26,32,40,49,61,75, \
				30,12,15,19,23,29,36,45,56,69,85, \
				35,14,17,22,27,34,42,52,64,78,96, \
				40,16,20,25,31,39,48,59,72,89,109, \
				45,18,23,29,36,44,55,67,82,101,124, \
				50,21,27,33,41,51,63,77,94,116,141, \
				55,25,31,39,48,59,72,88,108,132,160, \
				60,29,36,44,55,67,83,101,123,150,182, \
				65,33,41,51,63,77,94,115,139,169,205, \
				70,39,48,59,72,88,107,130,157,191,230, \
				75,45,55,67,82,100,122,148,179,216,260, \
				80,51,63,77,94,115,139,168,203,245,295, \
				85,60,73,89,109,132,160,193,232,279,334, \
				90,69,84,103,125,151,183,220,265,317,380, \
				95,80,97,118,144,174,209,251,301,361,431, \
				100,92,112,136,164,198,238,285,341,406,484, \
				105,107,130,158,190,228,274,327,390,464,551, \
				110,125,151,182,219,263,314,375,446,530,628, \
				115,146,176,212,254,303,362,431,512,607,718, \
				120,170,205,246,294,351,418,496,588,694,818

#define LTE_TABLE_0							\
        /* "(WAT 11.57%) Leakage Power"	 */                             \
        /**/  	        800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,13,16,19,22,26,31,36,43,51,60, \
				30,14,17,20,24,28,34,40,47,56,66, \
				35,16,19,22,26,31,37,44,52,61,72, \
				40,17,21,25,29,34,41,48,57,67,79, \
				45,19,23,27,32,38,45,53,63,74,88, \
				50,22,26,30,36,42,50,59,70,82,97, \
				55,24,29,34,40,47,56,66,77,92,108, \
				60,27,32,38,45,53,62,74,87,102,121, \
				65,30,36,43,50,59,70,83,98,115,136, \
				70,35,41,48,57,67,79,94,110,130,154, \
				75,39,46,55,65,76,90,106,125,148,174, \
				80,45,53,63,74,87,103,121,142,168,198, \
				85,51,61,72,85,100,117,138,163,191,226, \
				90,59,70,82,97,115,135,159,187,220,259, \
				95,68,81,95,112,132,156,183,215,253,298, \
				100,79,94,110,130,153,181,212,250,294,345, \
				105,93,109,129,152,179,210,247,290,341,401, \
				110,109,128,151,177,209,245,288,339,398,468, \
				115,128,151,177,208,245,288,338,396,466,548, \
				120,151,177,209,246,289,339,398,466,547,643

#define LTE_TABLE_1							\
        /* "(WAT 0.78%) Leakage Power" */                               \
        /**/ 	        800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,11,12,14,17,20,23,27,32,37,44, \
				30,11,13,15,18,20,24,28,33,39,46, \
				35,12,14,16,18,21,25,30,35,41,49, \
				40,12,14,17,20,23,27,31,37,43,52, \
				45,13,15,18,21,24,28,33,39,46,55, \
				50,14,16,19,22,26,30,36,42,50,59, \
				55,15,18,21,24,28,33,38,45,54,64, \
				60,17,19,22,26,30,35,42,49,58,69, \
				65,18,21,24,28,33,39,45,53,63,75, \
				70,20,23,27,31,36,42,50,58,69,82, \
				75,22,25,29,34,40,47,55,64,76,90, \
				80,24,28,32,38,44,52,61,71,84,100, \
				85,27,31,36,42,49,57,67,79,94,111, \
				90,30,35,41,47,55,64,75,89,105,125, \
				95,34,39,46,53,62,73,85,100,119,141, \
				100,39,45,52,60,70,82,97,114,134,159, \
				105,44,51,59,69,80,94,110,130,153,182, \
				110,50,58,68,79,92,108,126,149,176,209, \
				115,58,67,78,91,106,124,146,172,203,241, \
				120,67,78,90,105,123,144,169,199,235,279

#define LTE_TABLE_2							\
        /* "(WAT -8.16%) Leakage Power"	 */                             \
        /**/      	800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,10,12,14,16,19,22,26,30,36,43, \
				30,11,12,14,17,19,23,27,31,37,44, \
				35,11,13,15,17,20,23,28,33,39,46, \
				40,12,13,15,18,21,24,29,34,40,48, \
				45,12,14,16,19,22,26,30,36,42,50, \
				50,13,15,17,20,23,27,32,37,45,53, \
				55,14,16,18,21,24,29,34,40,47,56, \
				60,14,17,19,22,26,30,36,42,50,60, \
				65,15,18,21,24,28,33,38,45,54,64, \
				70,17,19,22,26,30,35,42,49,58,70, \
				75,18,21,24,28,33,38,45,53,63,76, \
				80,20,23,26,31,36,42,49,58,69,83, \
				85,22,25,29,34,39,46,54,64,76,91, \
				90,24,27,32,37,43,51,60,71,84,100, \
				95,26,31,35,41,48,56,67,79,93,112, \
				100,29,34,40,46,54,63,75,88,105,125, \
				105,33,38,44,52,60,71,84,99,118,141, \
				110,37,43,50,59,68,80,95,112,133,159, \
				115,43,49,57,67,78,91,108,127,152,181, \
				120,49,56,65,76,89,105,123,146,173,207

#define VCORE_TABLE_0							\
        /* "(WAT 11.57%) Leakage Power"	 */                             \
        /**/            800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,19,24,29,36,44,53,63,75,88,103, \
				30,20,25,31,38,46,55,66,78,92,107, \
				35,21,26,32,40,48,58,69,82,96,112, \
				40,22,27,34,42,51,61,73,86,101,117, \
				45,23,29,36,44,53,64,77,91,106,123, \
				50,25,31,38,47,57,68,81,96,113,131, \
				55,26,33,41,50,61,73,87,102,120,139, \
				60,28,36,44,54,65,78,93,109,128,149, \
				65,31,38,47,58,70,84,100,118,137,159, \
				70,33,42,51,63,76,91,108,127,148,172, \
				75,36,45,56,68,82,99,117,138,161,186, \
				80,40,49,61,74,90,107,127,150,175,202, \
				85,44,54,67,82,98,118,140,164,191,221, \
				90,48,60,74,90,108,130,154,180,210,242, \
				95,53,66,82,99,120,143,170,199,231,267, \
				100,60,74,91,111,133,159,188,221,256,295, \
				105,67,83,102,123,149,177,209,245,285,328, \
				110,75,93,114,138,166,198,234,274,318,367, \
				115,85,105,129,156,188,223,264,308,357,411, \
				120,96,119,146,177,212,253,298,348,403,464
				
#define VCORE_TABLE_1							\
        /* "(WAT 0.78%) Leakage Power"	 */                             \
        /**/            800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,15,19,24,29,36,44,53,63,75,87, \
				30,15,19,24,30,37,45,54,64,76,89, \
				35,16,20,25,31,38,46,55,66,78,91, \
				40,16,21,26,32,39,47,57,68,80,93, \
				45,17,21,27,33,40,49,59,70,82,95, \
				50,18,22,28,34,42,51,61,72,85,99, \
				55,18,23,29,36,44,53,63,75,88,102, \
				60,19,24,30,38,46,55,66,78,92,106, \
				65,20,26,32,39,48,58,69,82,96,111, \
				70,22,27,34,42,51,61,73,86,100,116, \
				75,23,29,36,44,54,64,77,90,105,122, \
				80,24,31,38,47,57,68,81,95,111,128, \
				85,26,33,41,50,60,73,86,101,118,136, \
				90,28,35,44,53,65,78,92,108,125,144, \
				95,30,38,47,57,69,83,98,115,134,154, \
				100,33,41,51,62,75,89,106,124,143,164, \
				105,36,45,55,67,81,96,114,133,154,177, \
				110,39,48,60,73,88,104,123,144,166,190, \
				115,43,53,65,79,95,113,133,156,180,206, \
				120,47,58,71,87,104,124,146,170,196,223
		
#define VCORE_TABLE_2							\
        /* "(WAT 11.57%) Leakage Power" */                              \
        /**/            800,	850,	900,	950,	1000,	1050,	1100,	1150,	1200,	1250, \
				25,14,17,22,28,34,42,51,61,73,86, \
				30,14,18,22,28,35,43,52,62,74,86, \
				35,14,18,23,29,35,43,52,63,74,87, \
				40,15,19,24,29,36,44,53,64,76,89, \
				45,15,19,24,30,37,45,55,65,77,90, \
				50,16,20,25,31,38,47,56,67,79,92, \
				55,16,20,26,32,39,48,58,69,81,95, \
				60,17,21,27,33,41,50,60,71,84,98, \
				65,18,22,28,35,42,52,62,74,87,101, \
				70,18,23,29,36,44,54,65,77,90,105, \
				75,19,25,31,38,46,56,67,80,94,109, \
				80,20,26,32,40,49,59,71,84,98,114, \
				85,22,27,34,42,52,62,75,88,103,120, \
				90,23,29,36,45,55,66,79,93,109,126, \
				95,25,31,39,48,58,70,84,99,115,133, \
				100,27,33,42,51,62,75,89,105,123,142, \
				105,29,36,45,55,67,80,95,112,131,151, \
				110,31,39,48,59,72,86,102,120,140,161, \
				115,34,42,52,64,77,93,110,129,150,173, \
				120,37,46,57,69,84,100,118,139,162,186
				
typedef struct spower_raw_s {
	int vsize;
	int tsize;
	int table_size;
	int *table[];
} spower_raw_t;


/** table order: ff, tt, ss **/

int cpu_leakage_data[][VSIZE*TSIZE+VSIZE+TSIZE] = {
		{ CPU_TABLE_0 },
		{ CPU_TABLE_1 },
		{ CPU_TABLE_2 },
};

int lte_leakage_data[][VSIZE*TSIZE+VSIZE+TSIZE] = {
		{ LTE_TABLE_0 },
		{ LTE_TABLE_1 },
		{ LTE_TABLE_2 },
};

int vcore_leakage_data[][VSIZE*TSIZE+VSIZE+TSIZE] = {
		{ VCORE_TABLE_0 },
		{ VCORE_TABLE_1 },
		{ VCORE_TABLE_2 },
};

spower_raw_t cpu_spower_raw = {
	.vsize = VSIZE,
	.tsize = TSIZE,
	.table_size = 3,
	.table = { (int *)&cpu_leakage_data[0], (int *)&cpu_leakage_data[1], (int *)&cpu_leakage_data[2] },
};

spower_raw_t lte_spower_raw = {
	.vsize = VSIZE,
	.tsize = TSIZE,
	.table_size = 3,
	.table = { (int *)&lte_leakage_data[0], (int *)&lte_leakage_data[1], (int *)&lte_leakage_data[2] },
};

spower_raw_t vcore_spower_raw = {
	.vsize = VSIZE,
	.tsize = TSIZE,
	.table_size = 3,
	.table = { (int *)&vcore_leakage_data[0], (int *)&vcore_leakage_data[1], (int *)&vcore_leakage_data[2] },
};



typedef struct voltage_row_s {
	int mV[VSIZE];
} vrow_t;
	
typedef struct temperature_row_s {
	int deg;
	int mA[VSIZE];
} trow_t;
	
	
typedef struct sptab_s {
	int vsize;
	int tsize;
	int *data; 		// array[VSIZE + TSIZE + (VSIZE*TSIZE)];
	vrow_t *vrow; 		// pointer to voltage row of data
	trow_t *trow;		// pointer to temperature row of data
} sptbl_t;

#define trow(tab, ti)		((tab)->trow[ti])
#define mA(tab, vi, ti) 	((tab)->trow[ti].mA[vi])
#define mV(tab, vi) 		((tab)->vrow[0].mV[vi])
#define deg(tab, ti)	 	((tab)->trow[ti].deg)
#define vsize(tab)		((tab)->vsize)
#define tsize(tab)		((tab)->tsize)
#define tab_validate(tab)	(!!(tab) && (tab)->data != NULL)

static inline void spower_tab_construct(sptbl_t (*tab)[], spower_raw_t *raw)
{
	int i;
        sptbl_t *ptab = (sptbl_t *)tab;

	for (i=0; i<raw->table_size; i++) {
		ptab->vsize = raw->vsize;
		ptab->tsize = raw->tsize;
		ptab->data = raw->table[i];
		ptab->vrow = (vrow_t *)ptab->data;
		ptab->trow = (trow_t *)(ptab->data + ptab->vsize);
		ptab++;
	}
}



#endif


